{% extends 'layout_full.html' %}

{% block content %}
<div class="row">
    <form action="{{ url_for('.buscar_indice') }}" method="POST" class="col s12 px-5">
        {{ search_form.csrf_token }}
        <div class="col s11 input-field">
            <i class="material-icons prefix">search</i>
            <input id="userq_field" type="search" class="validate" name="userquery" required>
            <label class="active" for="userq_field">Buscar</label>
        </div>
        <div class="col s1 input-field">
            <button class="btn waves-effect waves-light" type="submit" name="action">
                <i class="material-icons">search</i>
            </button>
        </div>
    </form>
</div>

<div class="results-wrapper container">
    {% if fotos.items %}
        {% for fila in fotos.items|slice(4) %}
        <div class="row fila--{{ loop.index }}">
            {% for foto in fila %}
            <div class="col s4">
                <div class="card">
                    <div class="card-image">
                        <a href="{{ url_for('.photo_details', id=foto.md5) }}"><img src="{{ url_for('.photo_thumbnail', id=foto.md5) }}"></a>
                        <a class="btn-floating halfway-fab waves-effect waves-light grey activator"><i class="material-icons">more_vert</i></a>
                    </div>
                    <div class="card-action">
                        <a class="waves-effect waves-light btn"><i class="material-icons">content_copy</i></a>
                    </div>
                    <div class="card-reveal">
                        <span class="card-title grey-text text-darken-4">{{ foto.headline }}<i class="material-icons right">close</i></span>
                        <p>{{ render_excerpt(foto.excerpt)|safe }}</p>
                        <i class="material-icons left">label</i> 
                        {% for k in foto.keywords %}
                        <div class="chip">{{ k }}</div>
                        {% endfor %}

                        <p><i class="material-icons left">person</i> {{ foto.taken_by }}</p>
                        <p><i class="material-icons left">file_upload</i> {{foto.uploader.name}}</p>
                        <p><i class="material-icons left">event</i> {{foto.taken_on}}</p>
                        <!-- opcionales -->
                        {% if foto.camera %}<p><i class="material-icons left">camera_alt</i> {{foto.camera}}</p>{% endif %}
                        {% if foto.fnumber %}<p><i class="material-icons left">camera</i> f/{{foto.fnumber}}</p>{% endif %}
                        {% if foto.exposuretime %}<p><i class="material-icons left">av_timer</i> {{foto.exposuretime}}s</p>{% endif %}
                        {% if foto.focal %}<p><i class="material-icons left">lens</i> {{foto.focal}}mm</p>{% endif %}
                        {% if foto.isovalue %}<p><i class="material-icons left">iso</i> {{foto.isovalue}}</p>{% endif %}
                        {% if foto.software %}<p><i class="material-icons left">brush</i> {{foto.software}}</p>{% endif %}
                        <!-- en opcionales -->
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        {% endfor %}

        <!-- paginacion -->
        {% if fotos.has_prev or fotos.has_next %}
        <div class="row">
            <div class="col s12">
                <div class="center-align mt-5">
                    <a href="{{ '#!' if fotos.has_prev is false else url_for('.mis_fotos', page=fotos.prev_num)}}" class="waves-effect waves-light btn {{ 'disabled' if fotos.has_prev is false else ''}}"><i class="material-icons left">chevron_left</i> Anterior</a>
                    <a href="{{ '#!' if fotos.has_next is false else url_for('.mis_fotos', page=fotos.next_num)}}" class="waves-effect waves-light btn ml-5 {{ 'disabled' if fotos.has_next is false else ''}}">Siguiente <i class="material-icons right">chevron_right</i></a>
                </div>
            </div>
        </div>
        {% endif %}

    {% else %}
        <div class="row">
            <div class="col s12">
                    <h1 class="center-align">No hay fotos tuyas en el sistema</h1>
                    <p class="center-align">
                        <a class="waves-effect waves-light btn" href="{{ url_for('.upload_coverture') }}"><i class="material-icons right">cloud_upload</i>Subir fotos</a>
                    </p>
            </div>
        </div>
    {% endif %}
</div>
{% endblock %}
