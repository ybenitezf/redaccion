{% extends 'layout_full.html' %}

{% block page_title %}Coberturas - {{ cobertura.headline }}{% endblock %}

{% block content %}

    <div class="row">

        <div class="col s6">

            <h4>Fotos</h4>
            <div class="gallery--row">

                {% for column in cobertura.photos|slice(3) %}
                <div class="gallery--col">
                    {% for foto in column %}
                        <div class="card">
                            <div class="card-image">
                                <img src="{{ url_for('.photo_thumbnail', id=foto.md5) }}" />
                                <!-- <a class="btn-floating btn-small halfway-fab waves-effect waves-light grey"><i class="material-icons">more_vert</i></a> -->
                            </div>
                            <div class="card-action">
                                <a class="btn-floating btn-small waves-effect waves-light red darken-4" title="Quitar de la galeria, no elimina la foto.">
                                    <i class="material-icons">remove</i>
                                </a>
                            </div>
                        </div>
                    {% endfor %}
                </div>
                {% endfor %}
            
            </div>
            <p class="grey-text text-darken-2 mx-4">
                Las fotos solo se eliminan de la galería, estas no se eliminan
                nunca del archivo fotográfico.
            </p>

        </div>
        <div class="col s6">
            <h4>Datos de la galería</h4>
            <p class="grey-text text-darken-2">
                Los cambios a estos datos solo afectan a la galería. 
                A menos que se marque la casilla 
                <strong>Aplicar cambios a las fotos</strong> en cuyo caso
                los cambios se aplicarán también a todas las fotos
            </p>
            <!-- campos basicos -->
            <div class="mt-5">
                <div class="input-field">
                    <input type="text" name="headline" id="headline_field" class="validate" required autocomplete="off" value="{{ cobertura.headline }}">
                    <label for="headline_field">Título descriptivo</label>
                </div>
                <div class="input-field">
                    <input type="text" name="creditline" id="creditline_field" class="validate" value="{{ cobertura.credit_line }}" required>
                    <label for="creditline_field">Creditos</label>
                </div>
                <div class="input-field" data-controller="chips" data-chips-tags-value='{{ chips|tojson|safe }}'>
                    <div class="chips chips-initial" data-chips-target="vista"></div>
                    <span class="helper-text">
                        Ingrese la palabra clave y presione <code class="grey darken-3 white-text p-1">ENTER</code>
                    </span>
                </div>
                <div class="input-field px-3 mt-5 mb-5" data-controller="editor" data-editor-entrada-value='{{ cobertura.excerpt | safe }}'>
                    <div id="excerpt_field" data-editor-target="editor"></div>
                </div>
            </div>
            <!-- end: campos basicos -->
            <hr />
            <!-- agregar mas fotos -->
            <div class="uploaderwraper mt-5">
                <h4>Agrega otra foto</h4>
                <p class="grey-text text-darken-2">
                    La foto será agregada con los datos actuales de la galería. 
                    Si ha realizado cambios a los datos anteriores, debe 
                    guardarlos primero y entonces agregar la foto.
                </p>
                <form  data-controller="imageupload" action="{{ url_for('.handle_upload') }}" method="POST">
                    <input type="hidden" name="healine" value='{{ cobertura.headline }}'>
                    <input type="hidden" name="creditline" value='{{ cobertura.credit_line }}'>
                    <input type="hidden" name="keywords" value='{{ cobertura.keywords | tojson | safe }}'>
                    <input type="hidden" name="excerpt" value='{{ cobertura.excerpt|safe }}'>
                    <input type="hidden" name="taken_by" value='{{ current_user.name }}'>
                    <input type="hidden" name="photo_coverage" value='{{ cobertura.id }}'>
                    <div class="file-field input-field">
                        <div class="btn" data-imageupload-target="btn">
                            <span>Agregar Foto</span>
                            <input type="file" name="image" accept="image/*" data-imageupload-target="file" />
                        </div>
                        <div class="file-path-wrapper">
                            <input class="file-path validate" type="text">
                        </div>
                    </div>
                </form>
            </div>
            <!-- end -->
        </div>

    </div>

{% endblock%}


{% block page_js %}
<script src="{{ static_url_for('static', filename='js/editcobertura.js') }}"></script>
{% endblock %}
